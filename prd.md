# HerPlus 智能戒指 APP 产品需求文档 (PRD)

| 文档属性     | 内容                 |
| :----------- | :------------------- |
| **项目名称** | HerPlus 智能戒指 APP |
| **版本号**   | v1.0 (MVP)           |
| **状态**     | **已评审 / 待开发**  |
| **最后更新** | 2025-01-08           |
| **作者**     | PM (John)            |

---

## 1. 目标与背景 (Goals and Background Context)

### 1.1 背景 (Background Context)
当前的智能穿戴市场主要由男性视角的“硬核科技”产品主导，往往侧重于冷冰冰的数据堆砌，忽视了女性用户对审美、情感连接及特有生理健康的需求。

**HerPlus** 旨在填补这一空白。它不仅仅是一个智能戒指的配套工具，更是一个为**高知女性**量身打造的**身心能量管理平台**。我们的设计理念是 **"Borderless, Soft & Healing" (无边框、柔和、疗愈)**，试图通过温暖的视觉语言和极简的交互，降低科技产品的侵入感。

产品核心围绕女性的**生理周期、情绪压力、睡眠质量**及**安全守护**展开。我们通过独特的“多态漩涡”可视化情绪，引入“Guardian”安全功能，并首创“She Impacts”公益模块，将个人健康数据转化为社会影响力，旨在帮助女性用户 "Listen to your inner voice"（倾听内心的声音）。

### 1.2 商业与产品目标 (Goals)
* **建立差异化品牌认知**：通过高辨识度的 UI/UX 设计（如“多态漩涡”、“情绪气象站”），确立 HerPlus 作为“懂女性、有温度”的高端健康科技品牌形象。
* **提升用户粘性与情感连接**：利用“情绪洞察”、“AI 沉浸对话舱”和“每日宣言”等功能，从单纯的工具属性转向情感陪伴属性，提高 DAU 和留存率。
* **构建安全与信任壁垒**：通过 Guardian 安全守护功能和透明的“隐私承诺”流程，建立用户对隐私安全的绝对信任。
* **促进数据闭环与科研价值**：通过“The Data Gap”实验室模块，鼓励用户参与女性健康研究，沉淀高质量数据。

### 1.3 核心成功指标 (Success Metrics)
* **佩戴与连接率**：日均指环佩戴时长 > 18小时。
* **情绪功能渗透率**：日均查看“情绪气象站”或使用“AI 对话舱”的用户比例 > 30%。
* **安全功能激活率**：Guardian 功能的开启率 > 40%。
* **用户满意度 (NPS)**：在视觉美学和情感关怀维度的评分显著高于竞品。

---

## 2. 需求 (Requirements)

### 2.1 功能性需求 (Functional Requirements)

#### 核心体验与硬件交互
* **FR1 - 沉浸式启动与初始化**: 支持动态视频启动页（新用户）与 3D 动画（老用户）无缝切换；提供分步初始化向导（性别、周期、隐私等）。
* **FR2 - 智能指环连接**: BLE 连接管理，支持自动重连。**异常处理**：频繁断连（1分钟>3次）提示“离身”；电量 <5% 自动断开保护。
* **FR3 - HID 隔空手势**: 支持通过指环手势控制手机翻页/快门（需手动开启）。

#### 健康监测与 AI 洞察
* **FR4 - 动态情绪气象站**: 首页基于压力值 (`stressIndex`) 渲染不同颜色的动态漩涡；Slot 轮播展示 Readiness 分数、心率、周期等。
* **FR5 - AI 沉浸对话舱**: 点击漩涡唤起半屏 AI 对话，AI 基于上下文主动发问，提供预测性回复标签。
* **FR6 - 女性健康追踪**: 记录经期与症状；结合夜间体温 (`skinTemperatureAbs`) 绘制曲线辅助判断排卵期。
* **FR7 - 睡眠结构分析**: 分析睡眠分期（深/浅/REM/清醒），以“睡眠意识云”形态展示。

#### 安全与守护 (The Guardian)
* **FR8 - 隐蔽式安全触发**: 识别指环特定手势（如长按/敲击）。
    * **Level 1 (脱身)**: 10秒延迟后模拟来电。
    * **Level 2 (SOS)**: 获取当前位置并发送短信给紧急联系人（依赖系统能力，非强制后台保活）。

#### 社区与公益
* **FR9 - 步数公益 (She Impacts)**: 步数折算公益金 (10k步=$1)，支持手动注入捐赠；每日 00:00 清零未捐步数。
* **FR10 - 科研众包**: 用户可加入女性健康研究项目，数据哈希脱敏上传。

### 2.2 非功能性需求 (Non-Functional Requirements)
* **NFR1 - 隐私安全**: 敏感数据及 AI 记录采用 AES-256 本地加密；SOS 位置共享无状态（不存轨迹）。
* **NFR2 - 性能**: 首页动态效果 ≥ 30 FPS；冷启动 < 1.5s。
* **NFR3 - 离线可用**: 断网环境下展示本地缓存，功能不崩溃。
* **NFR4 - AI 成本控制**: 集成豆包大模型，限制每日对话上限 10 轮。

---

## 3. Epic 列表 (Epic List)

| ID         | 名称                    | 简述                                         |
| :--------- | :---------------------- | :------------------------------------------- |
| **Epic 1** | **核心基建与连接**      | 启动、登录、初始化、蓝牙管理、AI 基础接入。  |
| **Epic 2** | **生理监测与可视化**    | 数据同步、首页多态漩涡、图表看板、女性周期。 |
| **Epic 3** | **AI 洞察与对话**       | 首页对话舱、豆包模型集成、专家咨询、周报。   |
| **Epic 4** | **安全守护 (Guardian)** | 手势识别、虚拟来电、SOS 紧急求助。           |
| **Epic 5** | **社区与公益**          | 步数折算、公益捐赠、去中心化社区内容。       |
| **Epic 6** | **个人中心与设置**      | 设备 OTA、隐私管理、系统设置。               |

---

## 4. 详细 Epic 设计 (Detailed Design)

### 4.1 Epic 1: 核心基建与连接 (Foundation & Connectivity)

**Epic 目标**: 完成 APP 的“出生证明”——让用户能进得来、连得上、看得到。

#### Story 1.1: 沉浸式启动页 (Splash Screen)
* **验收标准**:
    1.  [cite_start]**新老用户区分**: 新用户播放 3-5s 真人生活流视频 [cite: 55-56][cite_start]；老用户播放 1.5s 3D Logo 变形动画 [cite: 58-59]。
    2.  [cite_start]**兜底**: 视频加载超时 (>2s) 自动降级为静态图 [cite: 63]。
    3.  [cite_start]**跳转**: 动画结束自动路由至登录页或首页 [cite: 61-62]。

#### Story 1.2: 手机号一键登录/注册
* **验收标准**:
    1.  [cite_start]支持全球区号选择 (默认 +86) [cite: 89]。
    2.  [cite_start]手机号格式正确时“获取验证码”按钮才高亮 [cite: 90]。
    3.  [cite_start]验证码防刷 (60s 倒计时) [cite: 93]。
    4.  [cite_start]验证通过后根据 `is_new_user` 字段路由至向导或首页 [cite: 98-99]。

#### Story 1.3: 初始化向导与数据录入
* **验收标准**:
    1.  [cite_start]**分步流程**: P1(性别) -> P2(追踪意愿) -> P3(周期) -> P4(身体数据) -> P5(隐私承诺) [cite: 133-194]。
    2.  [cite_start]**断点续传**: 杀进程重启后，直接恢复至上次停留的步骤页面 [cite: 256-258]。
    3.  [cite_start]**性别逻辑**: 仅提供 [女性] 和 [不确定] 选项 [cite: 140-142]。
    4.  [cite_start]**离线提交**: 若 P5 提交时断网，本地缓存数据并提示重试 [cite: 252-255]。

#### Story 1.4: 蓝牙连接管理器 (BLE Manager)
* **验收标准**:
    1.  扫描广播名为 `HerPlus_Ring` 的设备并绑定。
    2.  [cite_start]维护 `CONNECTED`, `DISCONNECTED`, `CHARGING` 状态机 [cite: 1109-1113]。
    3.  [cite_start]**异常**: 1分钟内断连 >3 次锁定为 `AWAY` 状态；电量 <5% 主动断开 [cite: 385-388]。

#### Story 1.5: AI 基础服务接入 (AI Foundation)
* **验收标准**:
    1.  后端封装 **豆包** API，APP 不直接持有 Key。
    2.  **配额控制**: 每日总对话上限 **10 轮**，超限返回错误码 `QUOTA_EXCEEDED`。
    3.  [cite_start]支持为不同场景注入不同 System Prompt (人设) [cite: 353-354]。

### 4.2 Epic 2: 生理监测与可视化 (Vital Monitoring & Visualization)

**Epic 目标**: 实现“看见身体的声音”，将数据转化为艺术化视觉。

#### Story 2.1: 数据同步引擎
* **验收标准**:
    1.  APP 启动/前台激活时自动拉取指环历史数据。
    2.  支持增量更新，仅拉取新数据。
    3.  [cite_start]自动过滤心率异常噪点 (0 或 >220) [cite: 381]。

#### Story 2.2: 首页“多态漩涡”气象站
* **验收标准**:
    1.  [cite_start]**视觉映射**: `stressIndex < 30` (放松/清透), `30-70` (平衡/温暖), `> 70` (压力/警示) [cite: 283-287]。
    2.  [cite_start]**Slot 轮播**: 每 4s 切换展示 Readiness, RHR, 周期状态 [cite: 289-301]。
        * [cite_start]*Readiness 公式 (端侧)*: `0.4*Sleep + 0.4*(100-Stress) + 0.2*RHRScore` [cite: 293]。
    3.  [cite_start]**异常插播**: `stressIndex > 80` 时打断轮播，固定显示深呼吸建议 [cite: 302-305]。
    4.  [cite_start]**状态处理**: 未连接显示磨砂水雾 [cite: 308-312][cite_start]；充电显示呼吸光晕 [cite: 318-320]。

#### Story 2.3: 基础数据看板
* **验收标准**:
    1.  [cite_start]展示心率、血氧 (若设备支持)、体温偏差、呼吸率 4 个核心卡片 [cite: 469-477]。
    2.  [cite_start]绘制 24h 心率折线图 (含静息基准线) [cite: 479-486]。
    3.  [cite_start]绘制夜间血氧区域图，`< 90%` 处用高亮竖线标记风险 [cite: 487-490]。

#### Story 2.4: 女性健康与体温追踪
* **验收标准**:
    1.  [cite_start]首页展示周期状态环 (经期/卵泡/排卵/黄体) [cite: 509-512]。
    2.  [cite_start]绘制基础体温 (`skinTemperatureAbs`) 曲线，识别排卵日 Dip 特征 [cite: 516-523]。
    3.  [cite_start]支持经期日期修正和症状打标 [cite: 533-537]。
    4.  [cite_start]**发烧排除**: 若体温高且 RHR 高，标记为“发烧”，不参与周期预测 [cite: 526-527]。

#### Story 2.5: 历史趋势日历
* **验收标准**:
    1. [cite_start]**生命马赛克**: 月历视图，通过圆圈样式（实心/虚心/颜色）展示每日经期、排卵及情绪状态 [cite: 438-448]。
    
    2. [cite_start]点击历史日期弹出半屏详情浮层，支持补记 [cite: 632-643]。
    
       

### 4.3 Epic 3: AI 洞察与对话 (AI Insights & Chat)

**Epic 目标**: 通过 AI 技术将数据转化为情感陪伴，实现“懂你”的品牌核心。

#### Story 3.1: 首页 AI 沉浸对话舱 (Immersion Chat Overlay)
* **验收标准**:
    1.  [cite_start]**半屏沉浸 UI**: 点击首页漩涡，背景高斯模糊 (60% 黑)，底部升起半透明遮罩，无气泡框，文字直接悬浮 [cite: 328-331]。
    2.  [cite_start]**主动开场**: AI 基于点击时的 Slot 状态（如压力高/睡眠好）主动发起第一句问候 [cite: 339-340]。
    3.  [cite_start]**预测标签**: 每次 AI 发问后，生成 3 个胶囊选项（如 `[赶工期]` `[心情好]`），点击即发送 [cite: 341-344]。
    4.  [cite_start]**历史记录**: 本地仅保留最近 30 天记录，且对话界面仅保留最近 3-5 轮，旧对话渐隐消失 [cite: 348-350]。

#### Story 3.2: 豆包模型集成与配额管理 (Doubao Integration)
* **验收标准**:
    1.  **模型接入**: 后端统一接入 **豆包** 大模型 API。
    2.  **每日限额**: 全局计数器控制，单用户每日（首页+专家）总对话上限 **10 轮**。
        * 耗尽时：输入框置灰，提示 "今日 AI 能量已耗尽，明日再聊"。
    3.  **人设管理**: 支持 System Prompt 配置，确保输出语调为“温暖、非评判”的疗愈风格。

#### Story 3.3: AI 专家咨询 (AI Expert Consultation)
* **验收标准**:
    1.  [cite_start]**独立入口**: 专家详情页底部悬浮输入栏 "向 Aura 提问..." [cite: 704-706]。
    2.  [cite_start]**上下文隔离**: 与首页对话舱上下文不互通。专家 AI 仅回答特定领域问题（如冥想、心理）[cite: 353-354]。
    3.  [cite_start]**交互形态**: 提问后 **不跳转**，而是底部弹出半屏浮层 (Half-Sheet) 显示回答 [cite: 710-712]。
    4.  **推荐闭环**: 回复末尾可推荐相关课程卡片。

#### Story 3.4: AI 周期信箱 (Weekly Insight Letter)
* **验收标准**:
    1.  [cite_start]**入口**: "焕新" Tab 底部大卡片，未读红点提示 [cite: 669-675]。
    2.  [cite_start]**全屏信件**: 点击弹出 "磨砂玻璃 + 极光渐变" 全屏信件，展示本周身心总结 [cite: 787-793]。
    3.  **分享**: 支持生成 9:16 分享海报。

### 4.4 Epic 4: 安全守护 (Guardian)

**Epic 目标**: 提供隐蔽、快速的安全干预手段。

#### Story 4.1: 隐蔽式手势识别 (Stealth Trigger)
* **验收标准**:
    1.  [cite_start]**手势定义**: 识别 "长按触摸区 5秒" 或 "连续敲击 3 次" (开发阶段微调) [cite: 1151-1152]。
    2.  **触感反馈**: 识别成功后，指环立即 **短震动** (Haptic Tick) 确认。
    3.  **防误触**: 仅在 `wear_status == true` (佩戴中) 时生效。

#### Story 4.2: Level 1 虚拟来电 (Fake Call)
* **验收标准**:
    1.  **延迟触发**: 收到指令后等待 10秒 发起。
    2.  **仿真 UI**: 模拟系统来电界面，显示预设联系人 (默认 "Mom/Sister")。
    3.  **接听逻辑**: 点击 "接听" 进入计时界面；点击 "拒绝" 退出。

#### Story 4.3: Level 2 紧急求救 (SOS & Location)
* **验收标准**:
    1.  **定位**: 触发后请求高精度 GPS 定位。
    2.  **发送机制 (MVP)**:
        * 尝试调用系统短信发送接口，预填内容 "我触发了 HerPlus 紧急求救，位置: [URL]"。
        * 若系统限制后台发送，推送 **高优先级通知** 引导用户点击发送。
    3.  [cite_start]**位置隐私**: 生成的一次性 URL 有效期 1小时，无历史轨迹存储 [cite: 1165-1166]。

#### Story 4.4: 女性互助圈 (Sister Circle)
* **验收标准**:
    1.  支持添加紧急联系人 (姓名+电话)。
    2.  [cite_start]支持修改虚拟来电的显示名称和头像 [cite: 1161-1163]。

### 4.5 Epic 5: 社区与公益 (Global Her)

**Epic 目标**: 将步数转化为社会价值，去中心化社区。

#### Story 5.1: She Impacts 步数公益引擎
* **验收标准**:
    1.  **折算公式**: `10,000 步 = $1` 公益金。
    2.  **上限控制**: 单日计入公益金的步数封顶 **20,000 步**，超额不计。
    3.  **日结清零**: 每日 00:00 (本地时间) 重置待捐步数，过期清零。
    4.  [cite_start]**注入交互**: 用户手动点击 "注入能量"，播放粒子动画，更新项目进度 [cite: 973-976]。

#### Story 5.2: Global Her 社区主页
* **验收标准**:
    1.  [cite_start]**每日宣言**: 顶部日历撕页卡片，支持生成分享海报 [cite: 824-834]。
    2.  [cite_start]**双入口**: 展示 "She Impacts" (个人捐赠额) 和 "Data Lab" (科研项目) 入口 [cite: 838-856]。
    3.  [cite_start]**Her Zine**: 底部瀑布流展示文章，支持沉浸式阅读器 [cite: 882-900]。

#### Story 5.3: 科研众包平台 (The Data Gap)
* **验收标准**:
    1.  [cite_start]展示科研项目列表 (标题/机构/所需数据) [cite: 990-999]。
    2.  [cite_start]**授权开关**: 开启需同意条款；数据经 **哈希脱敏** 后上传 [cite: 1008-1016]。
    3.  **退出机制**: 关闭开关即停止上传，并触发后端删除历史数据。

#### Story 5.4: Her Movement 全球活动地图
* **验收标准**:
    1.  [cite_start]**极简地图**: 灰白风格，仅显示活动点位 (Teal 色棒棒糖图标) [cite: 860-864]。
    2.  **隐私限制**: 地图 **不显示** 其他用户位置；活动详情页头像 **不可点击**，无社交功能。
    3.  [cite_start]**活动报名**: 支持 RSVP 和添加到系统日历 [cite: 1050-1052]。

### 4.6 Epic 6: 个人中心与设置 (Me & Settings)

**Epic 目标**: 提供透明、可控的设备与数据管理。

#### Story 6.1: 设备管家
* **验收标准**:
    1.  [cite_start]展示 3D 指环模型及电量/连接状态 [cite: 1103-1106]。
    2.  [cite_start]**固件升级 (OTA)**: 仅在电量 > 50% 且蓝牙信号强时允许升级，支持断点续传 [cite: 1216-1217]。
    3.  [cite_start]**解绑**: 解绑后设备断连，但 APP 端历史数据保留 [cite: 1197-1199]。

#### Story 6.2: 系统设置与偏好
* **验收标准**:
    1.  **单位切换**: 支持 `公制/英制`，默认根据系统 Region 初始化。
    2.  [cite_start]**目标设置**: 支持自定义每日步数、卡路里、站立目标 [cite: 1301-1303]。
    3.  [cite_start]**HID 开关**: 手动开启/关闭指环控制手机功能 (翻页/快门) [cite: 1200-1205]。

#### Story 6.3: 数据隐私与导出
* **验收标准**:
    1.  **数据导出**: 生成 PDF 报告或 CSV 原始数据。
    2.  [cite_start]**清除历史**: 支持一键清除本地 AI 对话记录 [cite: 1273-1274]。
    3.  **账号注销**: 二次确认后注销，提示数据不可恢复。

---

## 5. 数据结构与权限 (Data & Permissions)

### 5.1 核心数据结构 (User Profile)
* [cite_start]**基础信息**: `gender` (仅 Female/Not_Sure), `dob` (出生日期), `height`, `weight` [cite: 236-237]。
* [cite_start]**周期模型**: `cycle_length` (默认28), `period_length` (默认5), `last_period_date` [cite: 167-171]。
* **隐私开关**: `is_research_active` (科研), `is_guardian_active` (守护)。

### 5.2 权限申请策略
* **蓝牙**: 首次打开连接面板时申请。
* **定位**: 仅在 **开启 Guardian 功能** 时申请，且说明仅用于 SOS。
* **通知**: 开启异常提醒或 Guardian 时申请。
* **日历**: 点击 "添加到日历" 时申请。